{
  "comments": [
    {
      "key": {
        "uuid": "fafc7978_a3b6a588",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 26,
      "author": {
        "id": 5492
      },
      "writtenOn": "2017-01-24T17:52:00Z",
      "side": 1,
      "message": "VM in a tenant network access the external network without..",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_36c1472f",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 26,
      "author": {
        "id": 4269
      },
      "writtenOn": "2017-01-27T10:18:47Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "fafc7978_a3b6a588",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_c00c7c97",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 33,
      "author": {
        "id": 6741
      },
      "writtenOn": "2017-01-25T11:54:21Z",
      "side": 1,
      "message": "NAPT (Network Address Port Translation) session will be created based on the IP + Port combination. In case of ICMP traffic it does not have port address. Hence current implementation does not support ICMP protocol in SNAT.\n\nIs there any specific requirement for supporting ICMP also in SNAT?",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_4658a456",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 33,
      "author": {
        "id": 670
      },
      "writtenOn": "2017-01-25T12:39:35Z",
      "side": 1,
      "message": "OpenStack supports ICMP, we should too. What do you mean by the \"NAPT session\"? This support would arrive from OVS, our ODL SNAT logic would not be used anymore as far as I understand it, only the NAPT centralized switch logic.",
      "parentUuid": "fafc7978_c00c7c97",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_16d1a3fb",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 33,
      "author": {
        "id": 4269
      },
      "writtenOn": "2017-01-27T10:18:47Z",
      "side": 1,
      "message": "Yes the tracking in handled by netfilter. It uses the tuples as below to track icmp connection uniquely with 192.168.111.254  being the extrenal IP.\n\nsrc\u003d192.168.111.254 dst\u003d192.168.111.23 type\u003d0 code\u003d0 id\u003d11138 mark\u003d0 zone\u003d5004 use\u003d1",
      "parentUuid": "fafc7978_4658a456",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_434ff992",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 40,
      "author": {
        "id": 5492
      },
      "writtenOn": "2017-01-24T17:52:00Z",
      "side": 1,
      "message": "On an NAPT Switch failure, there will continue to be traffic even with this approach right?",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_f6cdff5e",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 40,
      "author": {
        "id": 4269
      },
      "writtenOn": "2017-01-27T10:18:47Z",
      "side": 1,
      "message": "As of now it will continue. Ovs has plans to introduce a way to delete the exisitng connections. The support should be available by 2.7. We need to explore it.",
      "parentUuid": "fafc7978_434ff992",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_91a11dac",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 40,
      "author": {
        "id": 5492
      },
      "writtenOn": "2017-01-27T11:53:44Z",
      "side": 1,
      "message": "Aswin, i meant the above question by Chetan ..",
      "parentUuid": "fafc7978_b15c2127",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_1126cd16",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 40,
      "author": {
        "id": 4269
      },
      "writtenOn": "2017-01-27T13:40:15Z",
      "side": 1,
      "message": "This will be a limitation in the new implementation. We cannot re-install the existing translations.",
      "parentUuid": "fafc7978_91a11dac",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_8c88e223",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 40,
      "author": {
        "id": 5492
      },
      "writtenOn": "2017-01-27T13:58:16Z",
      "side": 1,
      "message": "But I believe a new conntrack session will get created on new NAPT Switch and translation rules will be put in place and traffic will continue.\n\nFrom the SNAT user side, there will be no loss of traffic seen for TCP on NAPT fail-over.  Some loss will be there for UDP and ICMP on NAPT fail-over.  But in both the case the traffic will not be a permanent drop at the end right?",
      "parentUuid": "fafc7978_1126cd16",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_ce749f9e",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 40,
      "author": {
        "id": 4269
      },
      "writtenOn": "2017-01-27T15:31:07Z",
      "side": 1,
      "message": "TCP will have to  establish a new connection. Netfilter will reject the packets which has not gone through the handshake as it maintains the connection state.\n\nUDP and ICMP will have some loss but should continue after that.",
      "parentUuid": "fafc7978_8c88e223",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_436899f5",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 44,
      "author": {
        "id": 5492
      },
      "writtenOn": "2017-01-24T17:52:00Z",
      "side": 1,
      "message": "So the changes to address this feature involves openflowplugin, genius and netvirt projects ?",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_56db2b1b",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 44,
      "author": {
        "id": 4269
      },
      "writtenOn": "2017-01-27T10:18:47Z",
      "side": 1,
      "message": "yes thats right.",
      "parentUuid": "fafc7978_436899f5",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_80eef489",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 52,
      "author": {
        "id": 6741
      },
      "writtenOn": "2017-01-25T11:54:21Z",
      "side": 1,
      "message": "What basis linux netfilter will remove the existing SNAT session which is no longer alive (NAPT HA).Please explain how the existing SNAT session will be handling for OVS down or Ideal time out scenario.",
      "range": {
        "startLine": 52,
        "startChar": 49,
        "endLine": 52,
        "endChar": 58
      },
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_564e8bc2",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 52,
      "author": {
        "id": 4269
      },
      "writtenOn": "2017-01-27T10:18:47Z",
      "side": 1,
      "message": "It is based on the idle timeout and is not controlled by ovs. In ovs down scenario if the ovs is back before netfilter entry times out, provided the ovs flows are intact, the connection should continue.",
      "parentUuid": "fafc7978_80eef489",
      "range": {
        "startLine": 52,
        "startChar": 49,
        "endLine": 52,
        "endChar": 58
      },
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_e3242dc8",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 65,
      "author": {
        "id": 5492
      },
      "writtenOn": "2017-01-24T17:52:00Z",
      "side": 1,
      "message": "the write_metadata value here should represent External VPN metadata which should be different from the matched metadata which represents the Router VPN.\nThis should happen in the flow rule that completes NATing action and so i think this should apply for both the flows of Table 46.",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_56fccb3e",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 65,
      "author": {
        "id": 4269
      },
      "writtenOn": "2017-01-27T10:18:47Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "fafc7978_e3242dc8",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_226f3ac7",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 66,
      "author": {
        "id": 4269
      },
      "writtenOn": "2017-01-30T05:10:36Z",
      "side": 1,
      "message": "@Tali\nTo match the inbound NAPT vpn-ids I suggest to change the vpn-id match in T26 and T46 to be 0x222e2\nso router vpn-id\u003d0x222e2 and ext-net vpn-id\u003d0x222e0\n\n@Aswin\nThe VPN id is now changed for the inbound NAT in table 43 now, the outbound NAT is now not dependent on the VPN id as we are checking the ct_state I think it should work fine.",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_364b07b2",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 67,
      "author": {
        "id": 4269
      },
      "writtenOn": "2017-01-27T10:18:47Z",
      "side": 1,
      "message": "1)This will be controlled by ovs flows and will continue as such us. Netfilter does not alter layer2 attributes.\n\n2)The plan is to have a ovs flow per subnet. So only the port selection will be done by netfilter.",
      "parentUuid": "fafc7978_86056cc4",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_6cee5e24",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 67,
      "author": {
        "id": 4269
      },
      "writtenOn": "2017-01-27T13:40:15Z",
      "side": 1,
      "message": "Is this a case of multiple external subnets in the same router? If so it is not handled, we can think of adding a group which will select the flow in future to load balance.",
      "parentUuid": "fafc7978_b12541ad",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_6c949e37",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 67,
      "author": {
        "id": 5492
      },
      "writtenOn": "2017-01-27T13:58:16Z",
      "side": 1,
      "message": "I don\u0027t think multiple external subnets for a router gateway (ie., external-fixed-ips from different subnets for the same router on its gateway side) ever works today.. \n\nChetan, can you please clarify the question?",
      "parentUuid": "fafc7978_6cee5e24",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_8248a65c",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 67,
      "author": {
        "id": 4269
      },
      "writtenOn": "2017-01-30T05:10:36Z",
      "side": 1,
      "message": "Chethan,\n\nTwo external subnet in a router is not supported with this spec, it can be considered as a further enhancement as suggested in the previous comment.",
      "parentUuid": "fafc7978_3493fca4",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_fe47a649",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 71,
      "author": {
        "id": 5492
      },
      "writtenOn": "2017-01-24T17:52:00Z",
      "side": 1,
      "message": "Packets come from Table 19 directly to Table 44.. \nSimilarly packets come from Table 20 directly to Table 44 too.\n\nNot sure where Table 21 interference comes from.  Can you please clarify this?",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_96c75312",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 71,
      "author": {
        "id": 4269
      },
      "writtenOn": "2017-01-27T10:18:47Z",
      "side": 1,
      "message": "This was taken from a flat provider use case , to show how the conntrack flows will fit in. The netfilter check now happens in table 44 and There will not be any change in table 19.20.21 flows.",
      "parentUuid": "fafc7978_fe47a649",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_9188fd23",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 71,
      "author": {
        "id": 5492
      },
      "writtenOn": "2017-01-27T11:53:44Z",
      "side": 1,
      "message": "In your flows you have shown the conntrack commit happen in Table 21 alone and that will work only for Flat/VLAN based external networks.  We have to cover MPLSOverGre and VXLAN based external networks too and for these two cases the packet will land from Table 20 and Table 19.  So my question was will this Spec cover type of external network other than VLAN/Flat ?",
      "parentUuid": "fafc7978_96c75312",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_d1356547",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 71,
      "author": {
        "id": 4269
      },
      "writtenOn": "2017-01-27T13:40:15Z",
      "side": 1,
      "message": "I changed the flow from the previous revision now the translation happens in table 44. My priority is in complete testing non-mpls first. But the flows should remain the same now I guess.",
      "parentUuid": "fafc7978_9188fd23",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_cc82eaff",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 71,
      "author": {
        "id": 5492
      },
      "writtenOn": "2017-01-27T13:58:16Z",
      "side": 1,
      "message": "Great thanks !",
      "parentUuid": "fafc7978_d1356547",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_5e74f29b",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 80,
      "author": {
        "id": 5492
      },
      "writtenOn": "2017-01-24T17:52:00Z",
      "side": 1,
      "message": "here you have swapped the metadata correctly :)",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_0274b697",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 199,
      "author": {
        "id": 4269
      },
      "writtenOn": "2017-01-30T05:10:36Z",
      "side": 1,
      "message": "@Tali\nWhat part of the implementation will be guarded by this config? Only the put_to_controller flow in the outbound NAPT table or are the more?\n\n@Aswin,\n\nYes it will the logic to punt to the controller and the related infrastructure will be guarded here.",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_7e73b6b1",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 208,
      "author": {
        "id": 5492
      },
      "writtenOn": "2017-01-24T17:52:00Z",
      "side": 1,
      "message": "Conntracking SNATing will not work with OVS+DPDK, and is that the reason why we have the configuration knob to turn OFF this feature?",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_267e40af",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 208,
      "author": {
        "id": 670
      },
      "writtenOn": "2017-01-25T12:39:35Z",
      "side": 1,
      "message": "Yes.. we might get it in OVS 2.7, I\u0027m not sure yet, Aswin can probably check once the feature is done",
      "parentUuid": "fafc7978_7e73b6b1",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_76cc6f36",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 17
      },
      "lineNbr": 208,
      "author": {
        "id": 4269
      },
      "writtenOn": "2017-01-27T10:18:47Z",
      "side": 1,
      "message": "Yes it is expected by ovs2.7",
      "parentUuid": "fafc7978_267e40af",
      "revId": "48342aaf9e8c864124d2a46ba01c266ceeb6d246",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    }
  ]
}