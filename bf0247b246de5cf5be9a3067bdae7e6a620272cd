{
  "comments": [
    {
      "key": {
        "uuid": "fafc7978_4955f34e",
        "filename": "vpnservice/elanmanager/elanmanager-impl/src/main/java/org/opendaylight/netvirt/elan/internal/ElanInterfaceManager.java",
        "patchSetId": 3
      },
      "lineNbr": 1532,
      "author": {
        "id": 817
      },
      "writtenOn": "2017-02-16T07:41:15Z",
      "side": 1,
      "message": "interface-manager uses entity owner, and hence interface-state addition can be triggered on a different node, synchronizing using DJC will not help if both these events are triggered on different nodes",
      "revId": "bf0247b246de5cf5be9a3067bdae7e6a620272cd",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_a9f29f6c",
        "filename": "vpnservice/elanmanager/elanmanager-impl/src/main/java/org/opendaylight/netvirt/elan/internal/ElanInterfaceManager.java",
        "patchSetId": 3
      },
      "lineNbr": 1532,
      "author": {
        "id": 5802
      },
      "writtenOn": "2017-02-16T07:52:16Z",
      "side": 1,
      "message": "You are right but don\u0027t we have the exact same situation in the code today if elan-interface config + ietf-interface state for the same are arriving simultaneously?\n\nWhat I\u0027m saying is that if there are clustering issues between elan and ietf-interface subtree they should be solved for the entire module. Maybe by making all the elan listeners clustered + write only from the ELAN leader but I don\u0027t feel this is something that should be done in the scope of solving regression",
      "parentUuid": "fafc7978_4955f34e",
      "revId": "bf0247b246de5cf5be9a3067bdae7e6a620272cd",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_89fd1b3d",
        "filename": "vpnservice/elanmanager/elanmanager-impl/src/main/java/org/opendaylight/netvirt/elan/internal/ElanInterfaceManager.java",
        "patchSetId": 3
      },
      "lineNbr": 1532,
      "author": {
        "id": 817
      },
      "writtenOn": "2017-02-16T07:57:53Z",
      "side": 1,
      "message": "You are right Tali, Not sure how it is working now, probably events are not arriving exactly at the same time :) your fix would have solved the issue, just coz it added some more delay in checking whether interface is up..",
      "parentUuid": "fafc7978_a9f29f6c",
      "revId": "bf0247b246de5cf5be9a3067bdae7e6a620272cd",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_49b1738e",
        "filename": "vpnservice/elanmanager/elanmanager-impl/src/main/java/org/opendaylight/netvirt/elan/internal/ElanInterfaceManager.java",
        "patchSetId": 3
      },
      "lineNbr": 1532,
      "author": {
        "id": 817
      },
      "writtenOn": "2017-02-16T08:10:21Z",
      "side": 1,
      "message": "Just wondering, instead of doing it this way, already there will be an interface-state listener in ELAN, where this should be done, isn\u0027t it?",
      "parentUuid": "fafc7978_a9f29f6c",
      "revId": "bf0247b246de5cf5be9a3067bdae7e6a620272cd",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_497853c4",
        "filename": "vpnservice/elanmanager/elanmanager-impl/src/main/java/org/opendaylight/netvirt/elan/internal/ElanInterfaceManager.java",
        "patchSetId": 3
      },
      "lineNbr": 1532,
      "author": {
        "id": 5802
      },
      "writtenOn": "2017-02-16T08:26:52Z",
      "side": 1,
      "message": "This method handleInternalTunnelStateEvent where the change was made is called only from within the elan interface-state listener\n\nThere is also ElanInterfaceStateClusteredListener taking care of external tunnel events. I initially thought about moving the internal tunnel handling to this listener but it seems all synced operations coming from this listener are related only to L2GW/HWVTEP events so I don\u0027t think it would help much to move the code there without changing behavior of all other ELAN listeners on all ext. tunnel related events",
      "parentUuid": "fafc7978_49b1738e",
      "revId": "bf0247b246de5cf5be9a3067bdae7e6a620272cd",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_3bd27600",
        "filename": "vpnservice/elanmanager/elanmanager-impl/src/main/java/org/opendaylight/netvirt/elan/internal/ElanInterfaceManager.java",
        "patchSetId": 3
      },
      "lineNbr": 1532,
      "author": {
        "id": 817
      },
      "writtenOn": "2017-02-16T09:40:36Z",
      "side": 1,
      "message": "ElanInterfaceStateListener is already calling the same installDmacAddressTables().. Any idea why this is not helping? Then probably the first race condition whatever I am pointing to is what is happening in this case..",
      "parentUuid": "fafc7978_497853c4",
      "revId": "bf0247b246de5cf5be9a3067bdae7e6a620272cd",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_5bf81a49",
        "filename": "vpnservice/elanmanager/elanmanager-impl/src/main/java/org/opendaylight/netvirt/elan/internal/ElanInterfaceManager.java",
        "patchSetId": 3
      },
      "lineNbr": 1532,
      "author": {
        "id": 670
      },
      "writtenOn": "2017-02-16T09:58:39Z",
      "side": 1,
      "message": "Faseela, this is the flow called by the ElanInterfaceStateChangeListener.\n\ninstallDMacAddressTables is only called from this flow as far as I can see.\n\nThe race we are all encountering is in 1node, even before considering cluster and EOS, which the DJC should fix.\n\nIf there are also clustering related races, we should take that up in subsequent patches.",
      "parentUuid": "fafc7978_3bd27600",
      "revId": "bf0247b246de5cf5be9a3067bdae7e6a620272cd",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_5b8f7acc",
        "filename": "vpnservice/elanmanager/elanmanager-impl/src/main/java/org/opendaylight/netvirt/elan/internal/ElanInterfaceManager.java",
        "patchSetId": 3
      },
      "lineNbr": 1532,
      "author": {
        "id": 5802
      },
      "writtenOn": "2017-02-16T10:01:19Z",
      "side": 1,
      "message": "Due to the parentRef changes related to LBaaS, tunnel creation takes place later for the 1st VM in each compute. When the interface-state of the 1st VM arrive the tunnel is yet to be created so remote DMAC flows contain drop action instead of output_to_tunnel.\nWhen the tunnel state comes up it attempts to fix the drop flows but sometimes get into concurrency issues with the elan-interface addition of the 1st VM.\n\nThis is the reason we see drop flow only in the DMAC flows of the 1st configured VM",
      "parentUuid": "fafc7978_3bd27600",
      "revId": "bf0247b246de5cf5be9a3067bdae7e6a620272cd",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    }
  ]
}