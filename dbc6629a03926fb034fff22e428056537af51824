{
  "comments": [
    {
      "key": {
        "uuid": "3e86d293_e33f5905",
        "filename": "/COMMIT_MSG",
        "patchSetId": 12
      },
      "lineNbr": 30,
      "author": {
        "id": 5867
      },
      "writtenOn": "2018-08-02T15:54:49Z",
      "side": 1,
      "message": "lot of sign offs here... ;-)",
      "revId": "dbc6629a03926fb034fff22e428056537af51824",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cddef8da_6835cc8a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 12
      },
      "lineNbr": 30,
      "author": {
        "id": 5346
      },
      "writtenOn": "2018-08-03T06:03:26Z",
      "side": 1,
      "message": "Somehow it got added during rebase :)\nRemoved them now.",
      "parentUuid": "3e86d293_e33f5905",
      "revId": "dbc6629a03926fb034fff22e428056537af51824",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b5eac7ae_2bb2818c",
        "filename": "vpnmanager/impl/src/main/java/org/opendaylight/netvirt/vpnmanager/VpnUtil.java",
        "patchSetId": 12
      },
      "lineNbr": 1039,
      "author": {
        "id": 5867
      },
      "writtenOn": "2018-08-02T15:54:49Z",
      "side": 1,
      "message": "this is not a great approach.  How about instead of this simply reading it before you try to delete it?  Of course, sn the same ReadWrite transaction, so using a ManagedTransactionRunner instead of the SingleTransactionDataBroker.",
      "revId": "dbc6629a03926fb034fff22e428056537af51824",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "54a269a8_9da038ff",
        "filename": "vpnmanager/impl/src/main/java/org/opendaylight/netvirt/vpnmanager/VpnUtil.java",
        "patchSetId": 12
      },
      "lineNbr": 1039,
      "author": {
        "id": 5346
      },
      "writtenOn": "2018-08-02T18:47:05Z",
      "side": 1,
      "message": "My intention here is to avoid extra read operation and also to avoid dealing with synchronization issues like below:\n1. Thread/Transaction tx1 read VpnInterface.\n2. Thread/Transaction tx2 delete VpnInterface.\n3. tx1 delete VpnInterface/Adjacency. This would again lead to ModifiedNodeDoesNotExistException.",
      "parentUuid": "b5eac7ae_2bb2818c",
      "revId": "dbc6629a03926fb034fff22e428056537af51824",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f9e293b8_d9040bea",
        "filename": "vpnmanager/impl/src/main/java/org/opendaylight/netvirt/vpnmanager/VpnUtil.java",
        "patchSetId": 12
      },
      "lineNbr": 1039,
      "author": {
        "id": 5867
      },
      "writtenOn": "2018-08-06T09:13:45Z",
      "side": 1,
      "message": "Why avoid the extra read operation?  To me, the increasing general fear ;) of doing any reads seems to be exaggerated.. that is what we do to get a consistent view of the data store.\n\nRe. the synchronization issue, that would depend on exactly when tx2 would commit its delete.  If tx1 commited another delete after tx2, that should cause a OptimisticLockFailedException instead of a ModifiedNodeDoesNotExistException.. and if you use a RetryingManagedNewTransactionRunner here, then the https://github.com/opendaylight/genius/blob/master/mdsalutil/mdsalutil-api/src/main/java/org/opendaylight/genius/infra/RetryingManagedNewTransactionRunnerImpl.java would deal with it and upon retrying would re-read, see it\u0027s not there, and not delete it anymore - and all good.\n\nSo I still think this is not a great approach.",
      "parentUuid": "54a269a8_9da038ff",
      "revId": "dbc6629a03926fb034fff22e428056537af51824",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "29d17664_7cf84602",
        "filename": "vpnmanager/impl/src/main/java/org/opendaylight/netvirt/vpnmanager/VpnUtil.java",
        "patchSetId": 12
      },
      "lineNbr": 1039,
      "author": {
        "id": 5346
      },
      "writtenOn": "2018-08-06T10:36:44Z",
      "side": 1,
      "message": "Thanks Michael for your suggestions.\nBut here the requirement is very simple. Just delete the object VpnInterface/Adjacencies/Adjacency.\nIf the parent VpnInterface itself is deleted, then I understand that Adjacency is also deleted, so no need to handle further.\n\nFor me, it makes more sense to use RetryingManagedNewTransactionRunnerImpl.java when it doesn\u0027t delete in the first attempt, so I need to do n retries.\nThis is not the case in this scenario.\nWhy should I do extra read and/or retries when I know that the object is already deleted via ModifiedNodeDoesNotExistException? My expectation is met.\n\nRegarding read and then delete approach, if this is the case then every delete operation should follow this approach. Right? \n\nSorry, I might be dragging a bit on this topic here as this approach is not convincing to me.\n\nIn general, if I just think about the delete API, it should do two things:\n- Delete the object if not already deleted.\n- If it\u0027s already deleted, inform the caller about the same.",
      "parentUuid": "f9e293b8_d9040bea",
      "revId": "dbc6629a03926fb034fff22e428056537af51824",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3ce3bc9f_da7db82a",
        "filename": "vpnmanager/impl/src/main/java/org/opendaylight/netvirt/vpnmanager/VpnUtil.java",
        "patchSetId": 12
      },
      "lineNbr": 1039,
      "author": {
        "id": 5867
      },
      "writtenOn": "2018-08-06T11:06:14Z",
      "side": 1,
      "message": "if you are suggesting a change to the delete API behaviour, you could raise that on controller-dev and mdsal-dev lists? Being as it is today, my view is that \"} catch (TransactionCommitFailedException e) { if (e.getCause() instanceof ModifiedNodeDoesNotExistException) {\" is not a pattern we should use.  But having now given my view on this, and not actually being a netvirt commiter, let me remove my -1 and let netvirt commiters judge if they really want to merge this.  BTW:  The CONTROLLER-1855 issue may interest you, in this context.",
      "parentUuid": "29d17664_7cf84602",
      "revId": "dbc6629a03926fb034fff22e428056537af51824",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    }
  ]
}