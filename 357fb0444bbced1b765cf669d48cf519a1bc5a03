{
  "comments": [
    {
      "key": {
        "uuid": "c81c3f8b_39a56754",
        "filename": "docs/specs/router-chaining-for-single-subnet.rst",
        "patchSetId": 13
      },
      "lineNbr": 162,
      "author": {
        "id": 5357
      },
      "writtenOn": "2018-01-31T09:19:31Z",
      "side": 1,
      "message": "Since determining which router is the default router depends solely on the order of events this is an issue for upgrade. During upgrade ODL\u0027s md-sal cache is wiped and then re-synced by some upgrade orchestrator (in our case networking-odl). In this case the entity doing the re-sync will not necessarily know (neutron doesn\u0027t know!) which router association came first which can result in a different order of creation and therefor a different default router selection. \nNote that in general this is not a great design since the order in which objects and associations are created is not a formalized part of the API specification.",
      "revId": "357fb0444bbced1b765cf669d48cf519a1bc5a03",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cd6722f7_989b55be",
        "filename": "docs/specs/router-chaining-for-single-subnet.rst",
        "patchSetId": 13
      },
      "lineNbr": 162,
      "author": {
        "id": 5433
      },
      "writtenOn": "2018-02-01T01:38:47Z",
      "side": 1,
      "message": "The router is designated as default router for a subnet if the subnet\u0027s gateway ip address is the same as router interface ip address. The default router for a subnet could be changed when another chained router is promoted to default router. The promotion can happen in one of two scenarios below:\n\n1) The subnet\u0027s gateway ip address is updated to the to-be-promoted router\u0027s interface ip address, eg\n  openstack subnet set --gateway\u003drouter-ifc-ip subnet-id\n2) The default router is now dissociated with the subnet, eg \n  openstack router remove subnet/port\n\nFor scenario 2) after promoting new default router, user need to manually update the subnet\u0027s gateway ip address to interface ip of the promoted router.\n\nPlease let me know if the above is acceptable. Thanks",
      "parentUuid": "c81c3f8b_39a56754",
      "revId": "357fb0444bbced1b765cf669d48cf519a1bc5a03",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6dce51aa_32426e56",
        "filename": "docs/specs/router-chaining-for-single-subnet.rst",
        "patchSetId": 13
      },
      "lineNbr": 162,
      "author": {
        "id": 5357
      },
      "writtenOn": "2018-02-01T08:28:57Z",
      "side": 1,
      "message": "Wait, I understood this document to imply that there can be more than a single \"candidate\" for default router and that the default is selected based on the fact that the association with the subnet happened first. Is this not the case?\n\nJust wanted to clarify my question here. Upgrade basically works like this (simplified for the sake of this conversation):\n Step 1: shutdown ODL\n Step 2: wipe ODL mdsal cache files\n Step 3: bring up new version of ODL. At this point the mdsal data stores are empty\n Step 4: resync all neutron configuration via the ODL neutron NB API. \nCurrently, step 4 is handled using networking-odl\u0027s full sync functionality which reads all the neutron objects from the database and sends them via REST to ODL. Since the router\u003c-\u003esubnet association is just a port object there is no guarantee that the port objects will be pushed to ODL in the order they were created. So, if the order of the creation of the router\u003c-\u003esubnet association matters at all, it will break during an upgrade scenario.",
      "parentUuid": "cd6722f7_989b55be",
      "revId": "357fb0444bbced1b765cf669d48cf519a1bc5a03",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    }
  ]
}