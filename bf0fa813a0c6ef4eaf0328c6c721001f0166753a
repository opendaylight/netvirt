{
  "comments": [
    {
      "key": {
        "uuid": "fafc7978_11d026c8",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 4
      },
      "lineNbr": 27,
      "author": {
        "id": 5492
      },
      "writtenOn": "2017-02-20T10:08:08Z",
      "side": 1,
      "message": "There was a clear reason why only those ovs-datapaths with atleast one port available on the routed subnet, were elected as NAPT Switches.\n\nThe NAPT Switch needs to have remote flow rules for every possible floating-ip and internal-ip within the DC.  These remote flow rules are required for internal-ip for a successful intra-DC Reverse SNAT Traffic enablement and remote rules for floating-ip are required for a successful intra-DC DNAT-to-DNAT traffic enablement.\n\nIf you retain some switch that is not having a participating \nport on the router, how will traffic flow work?",
      "revId": "bf0fa813a0c6ef4eaf0328c6c721001f0166753a",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_78222e53",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 4
      },
      "lineNbr": 27,
      "author": {
        "id": 4269
      },
      "writtenOn": "2017-02-21T14:27:29Z",
      "side": 1,
      "message": "Vivek\nThanks  for the insight.\n\nBut we do have similar issue with conntrack based implementation if we change the NAPT switch all the translations will be lost. When the switch really goes down it is unavoidable, but the failover happening during operations like vm/subnet delete needs to be avoided for this implementation.\n\nSo can we think of an option of maintaining the remote flows in the NAPT switch, even when the last port is removed?",
      "parentUuid": "fafc7978_11d026c8",
      "revId": "bf0fa813a0c6ef4eaf0328c6c721001f0166753a",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_560bb67c",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 4
      },
      "lineNbr": 27,
      "author": {
        "id": 5492
      },
      "writtenOn": "2017-02-22T11:54:56Z",
      "side": 1,
      "message": "It looks like what you need is just a designated switch regardless of presence of the subnets belonging to the router on the NAPTSwitch.  Basically, a sticky NAPTSwitch..\n\nYou can create a pseudo-port on the first elected NAPTSwitch and leave it there for all the rules to be retained.  we can have this pseudo-port enrolled in the NAT-owned-DPN-To-VPN-List alone and manage that pseudo-port based on the elected NAPTSwitch going down.\n\nPlease discuss this option with Tali / Yugandhar.  Basically am looking for a minimalistic change that is purely NAT centric to realize this rather than havingthe implementation swing its arms across the entire VPN Engine and FibManager.",
      "parentUuid": "fafc7978_78222e53",
      "revId": "bf0fa813a0c6ef4eaf0328c6c721001f0166753a",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_78e98ee5",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 4
      },
      "lineNbr": 29,
      "author": {
        "id": 4269
      },
      "writtenOn": "2017-02-21T14:27:29Z",
      "side": 1,
      "message": "Thanks for description with the usecase,as explained above can we consider the option of changing this behavior?",
      "parentUuid": "fafc7978_3c39c1d7",
      "revId": "bf0fa813a0c6ef4eaf0328c6c721001f0166753a",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_91e376a3",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 4
      },
      "lineNbr": 30,
      "author": {
        "id": 5492
      },
      "writtenOn": "2017-02-20T10:13:03Z",
      "side": 1,
      "message": "Is there a problem with this at all?  A dhcp service port is also plumbed by ODL only :)",
      "revId": "bf0fa813a0c6ef4eaf0328c6c721001f0166753a",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_581f6a08",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 4
      },
      "lineNbr": 30,
      "author": {
        "id": 4269
      },
      "writtenOn": "2017-02-21T14:27:29Z",
      "side": 1,
      "message": "The problem is like DHCP port will be in the node where agent is running and there are chances that all NAPT switch will be scheduled on the this node as DHCP port is the first port created along with subnet create.",
      "parentUuid": "fafc7978_91e376a3",
      "revId": "bf0fa813a0c6ef4eaf0328c6c721001f0166753a",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_b6bf82a9",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 4
      },
      "lineNbr": 30,
      "author": {
        "id": 5492
      },
      "writtenOn": "2017-02-22T11:54:56Z",
      "side": 1,
      "message": "That DHCP agent won\u0027t anyway interfere with NAT traffic right..\n\nToday we donot distinguish computes and control nodes.. We take all nodes that have some ports present on the router and elect one of the to be the NAPTSwitch.",
      "parentUuid": "fafc7978_581f6a08",
      "revId": "bf0fa813a0c6ef4eaf0328c6c721001f0166753a",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_111f865c",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 4
      },
      "lineNbr": 61,
      "author": {
        "id": 5802
      },
      "writtenOn": "2017-02-20T08:32:53Z",
      "side": 1,
      "message": "Is there any special reason why we want to maintain the current selection algorithm and not switch all cases to use the new logic?",
      "range": {
        "startLine": 61,
        "startChar": 0,
        "endLine": 61,
        "endChar": 67
      },
      "revId": "bf0fa813a0c6ef4eaf0328c6c721001f0166753a",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_117b067c",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 4
      },
      "lineNbr": 61,
      "author": {
        "id": 4269
      },
      "writtenOn": "2017-02-20T09:08:57Z",
      "side": 1,
      "message": "The current HA implementation is highly coupled with controller based/bgp vpn implementation and the effort required to change it is much higher. The new HA framework shall be independent from the NAPT implementation(controller/conntrack). We can think of migrating the existing selection to the new framework when required.",
      "parentUuid": "fafc7978_111f865c",
      "range": {
        "startLine": 61,
        "startChar": 0,
        "endLine": 61,
        "endChar": 67
      },
      "revId": "bf0fa813a0c6ef4eaf0328c6c721001f0166753a",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_b154baff",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 4
      },
      "lineNbr": 69,
      "author": {
        "id": 5802
      },
      "writtenOn": "2017-02-20T08:32:53Z",
      "side": 1,
      "message": "Will it still be possible to select control nodes to be the NAPT switches after this change?",
      "revId": "bf0fa813a0c6ef4eaf0328c6c721001f0166753a",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_b1d79a4a",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 4
      },
      "lineNbr": 69,
      "author": {
        "id": 4269
      },
      "writtenOn": "2017-02-20T09:08:57Z",
      "side": 1,
      "message": "It will be always distributed with control node having some of them.",
      "parentUuid": "fafc7978_b154baff",
      "revId": "bf0fa813a0c6ef4eaf0328c6c721001f0166753a",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_b19cba10",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 4
      },
      "lineNbr": 69,
      "author": {
        "id": 5492
      },
      "writtenOn": "2017-02-20T10:13:03Z",
      "side": 1,
      "message": "If control nodes have ports on a router-interface and such nodes are plumbed by ODL, they must continue to be considered.",
      "parentUuid": "fafc7978_b1d79a4a",
      "revId": "bf0fa813a0c6ef4eaf0328c6c721001f0166753a",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fafc7978_b8ef76e8",
        "filename": "docs/specs/conntrack-based-snat.rst",
        "patchSetId": 4
      },
      "lineNbr": 69,
      "author": {
        "id": 4269
      },
      "writtenOn": "2017-02-21T14:27:29Z",
      "side": 1,
      "message": "With this proposal control node will be considered, but not based on the presence of a port in the router subnet.",
      "parentUuid": "fafc7978_b19cba10",
      "revId": "bf0fa813a0c6ef4eaf0328c6c721001f0166753a",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    }
  ]
}