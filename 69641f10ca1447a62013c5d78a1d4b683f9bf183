{
  "comments": [
    {
      "key": {
        "uuid": "7a6b29fe_85765e04",
        "filename": "vpnservice/vpnmanager/vpnmanager-impl/src/main/java/org/opendaylight/netvirt/vpnmanager/ArpNotificationHandler.java",
        "patchSetId": 1
      },
      "lineNbr": 147,
      "author": {
        "id": 5492
      },
      "writtenOn": "2016-09-20T02:08:08Z",
      "side": 1,
      "message": "}I understand you want the code path of elanService.handleArpRequestFromExternalInterface() to be excited for this use-case.\n\nBut this fix will break External VPN ARP functionality for us!\n\nIs the target IP here is the external network\u0027s subnet gateway ip ?\n\nWondering why vpnTargetIpToPort is being filled for FloatingIPs.  That in itself is a bug we have to fix if happening !\n\nIf that is a long pole, better to move the following piece into the \"else\" case for (vpnTargetIpToPort.isSubnetIp()):\n\nif (elanService.isExternalInterface(srcInterface)) {\n                        handleArpRequestFromExternalInterface(srcInterface, srcIP, srcMac, targetIP);\n\n}",
      "revId": "69641f10ca1447a62013c5d78a1d4b683f9bf183",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a6b29fe_b0ec7a2b",
        "filename": "vpnservice/vpnmanager/vpnmanager-impl/src/main/java/org/opendaylight/netvirt/vpnmanager/ArpNotificationHandler.java",
        "patchSetId": 1
      },
      "lineNbr": 147,
      "author": {
        "id": 5278
      },
      "writtenOn": "2016-09-20T04:42:30Z",
      "side": 1,
      "message": "Yes,  we should not make entry into vpnTargetIpToPort for floating IP address at any case.\nFor timely workaround, you can provide the above workaround (the one Vivek mentioned) to fix this issue.",
      "parentUuid": "7a6b29fe_85765e04",
      "revId": "69641f10ca1447a62013c5d78a1d4b683f9bf183",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a6b29fe_107a8e23",
        "filename": "vpnservice/vpnmanager/vpnmanager-impl/src/main/java/org/opendaylight/netvirt/vpnmanager/ArpNotificationHandler.java",
        "patchSetId": 1
      },
      "lineNbr": 147,
      "author": {
        "id": 6177
      },
      "writtenOn": "2016-09-20T07:18:39Z",
      "side": 1,
      "message": "Thanks for your informative reply.\nFirst thing, as I wrote in the change description, I agree that the floating IP getting into vpnTargetIpToPort is a bug, and should be fixed.\n\nHowever, I don\u0027t think ARP caching should affect regular ARP flows in any case. The proposed change will break floating IP arp responses for floating IPs which are not learnt into vpnTargetIpToPort (which is even worse than the current state).\n\nSorry for not noticing that my change affects the isExternalVpn() use case, but I think that the way the code is currently written is very misleading. If I understand correctly, the vpnTargetIpToPort model is used for two different reasons here - One as an ARP cache to avoid ARP handling in the isExternalVpn usecase, and one as a way to tell whether the targetIp is a subnetIp.\n\nI suggest the following change (once again, apologies if I missed something as I am not familiar with isExternalVpn use case).\n\nif (isExternalVpn) {\n  if (vpnTargetIpToPort !\u003d null) {\n    if (vpnTargetIpToPort.isSubnetIp()) {\n\t  // respond as usual\n\t}\n    return;\t\n  }\n  // handle isExternalVpn as usual\n  return;\n}\nif (vpnTargetIpToPort \u0026\u0026 vpnTargetIpToPort.isSubnetIp()) { // handle router interfaces ARP\n  // respond as usual\n  return;\n}\nif (elanService.isExternalInterface(srcInterface)) {\n  // respond as usual\n  return;\n}",
      "parentUuid": "7a6b29fe_b0ec7a2b",
      "revId": "69641f10ca1447a62013c5d78a1d4b683f9bf183",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a6b29fe_b07c7aed",
        "filename": "vpnservice/vpnmanager/vpnmanager-impl/src/main/java/org/opendaylight/netvirt/vpnmanager/ArpNotificationHandler.java",
        "patchSetId": 1
      },
      "lineNbr": 147,
      "author": {
        "id": 5492
      },
      "writtenOn": "2016-09-20T07:54:07Z",
      "side": 1,
      "message": "The above change you in flow is OK..\nPlease make the changes and post it as next PS.\n\nUsing NeutronVpnPortIpToPort with multiple semantics lands up into code confusion..\n\nI believe we need to pin the semantic to NeutronVpnPortIpToPort so that it captures only neutron configuration (and no learning). It should not be used for any other purpose and it can be a Config DS.\n\nThere will be another datastore MipPortIpToPort that will capture ARP requests, ARP responses and GARP requests and that will be Operational in nature and that will store Non-Neutron ports like VIPs.   This MipPortIpToPort will serve as an ARP Cache inside the Controller as it will always have only datapath learned entries and can be managed\nfor expiration and other things.\n\nNow this semantic pinning can be a separate review after this !",
      "parentUuid": "7a6b29fe_107a8e23",
      "revId": "69641f10ca1447a62013c5d78a1d4b683f9bf183",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7a6b29fe_ab3a4b96",
        "filename": "vpnservice/vpnmanager/vpnmanager-impl/src/main/java/org/opendaylight/netvirt/vpnmanager/ArpNotificationHandler.java",
        "patchSetId": 1
      },
      "lineNbr": 147,
      "author": {
        "id": 6177
      },
      "writtenOn": "2016-09-20T09:52:32Z",
      "side": 1,
      "message": "I already posted the second review, please see changeset 2.\n\nTotally agree with the rest of the comments (not implemented inside this review)",
      "parentUuid": "7a6b29fe_b07c7aed",
      "revId": "69641f10ca1447a62013c5d78a1d4b683f9bf183",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    }
  ]
}