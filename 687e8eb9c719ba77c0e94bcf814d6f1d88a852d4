{
  "comments": [
    {
      "key": {
        "uuid": "7281db1e_164c6bc2",
        "filename": "docs/specs/router-chaining-for-single-subnet.rst",
        "patchSetId": 12
      },
      "lineNbr": 15,
      "author": {
        "id": 4534
      },
      "writtenOn": "2018-01-11T04:32:35Z",
      "side": 1,
      "message": "how can this be configured by ODL? when a router i/f is added into the subnet, only 1 will get the IP corresponding to the default g/w IP, that should become the default router, right? any other router i/fs added into the n/w will get other IPs from the subnet. (not sure if this logic has been updated in more recent openstack releases)",
      "range": {
        "startLine": 15,
        "startChar": 58,
        "endLine": 15,
        "endChar": 59
      },
      "revId": "687e8eb9c719ba77c0e94bcf814d6f1d88a852d4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "db10204c_55c5bbca",
        "filename": "docs/specs/router-chaining-for-single-subnet.rst",
        "patchSetId": 12
      },
      "lineNbr": 16,
      "author": {
        "id": 4534
      },
      "writtenOn": "2018-01-11T04:32:35Z",
      "side": 1,
      "message": "need to make sure this property is stored in config, so that order of reading during md-sal does not affect default router selection",
      "range": {
        "startLine": 16,
        "startChar": 78,
        "endLine": 16,
        "endChar": 79
      },
      "revId": "687e8eb9c719ba77c0e94bcf814d6f1d88a852d4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4ef808ca_a38671c0",
        "filename": "docs/specs/router-chaining-for-single-subnet.rst",
        "patchSetId": 12
      },
      "lineNbr": 22,
      "author": {
        "id": 4534
      },
      "writtenOn": "2018-01-11T04:32:35Z",
      "side": 1,
      "message": "shouldnt this be defined by vm config? when the subnet is configured, the default g/w for the vm is set, and used by dhcp to configure the vms tables. based on this, vm will arp for mac of its next hop, and odl needs to return the mac corresponding to the ip address of that router. i dont know how ODL will be able to choose any router for fwding here. the only chaining via netvirt might be possible if a user adds a static route into 1 router which points to the next router, in which case 1 fib lookup could be punted to go into the next fib.\neither that, or we need to manipulate the specific prefix routes and/or default routes published to vm\u0027s to ensure the right router forwards the pkts received.",
      "range": {
        "startLine": 22,
        "startChar": 86,
        "endLine": 22,
        "endChar": 87
      },
      "revId": "687e8eb9c719ba77c0e94bcf814d6f1d88a852d4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "79674f0a_b6faba7c",
        "filename": "docs/specs/router-chaining-for-single-subnet.rst",
        "patchSetId": 12
      },
      "lineNbr": 175,
      "author": {
        "id": 7781
      },
      "writtenOn": "2018-01-09T17:36:45Z",
      "side": 1,
      "message": "Is it matching with src_vm_ip or src_vm_subnet_cidr. Since as per the example dump-flows it matches src_subnet_cidr and dst_subnet_cidr. In this case can we rename as \"subnet1_cidr\" and \"subnet2_cidr\". Even openstack also subnet-address with slash notation is called as \"subnet-cidr\".",
      "range": {
        "startLine": 175,
        "startChar": 49,
        "endLine": 175,
        "endChar": 56
      },
      "revId": "687e8eb9c719ba77c0e94bcf814d6f1d88a852d4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f71b1e5c_8acd1af8",
        "filename": "docs/specs/router-chaining-for-single-subnet.rst",
        "patchSetId": 12
      },
      "lineNbr": 253,
      "author": {
        "id": 7781
      },
      "writtenOn": "2018-01-10T11:32:56Z",
      "side": 1,
      "message": "Hi Vinh,\n\nI see UC-2 doesn’t holds good for handling external network with provider type as “GRE”. Consider the following topology for understanding the problem UC.\n\n1)Network1 –\u003e Subnetwork1 (10.10.10.0/24) -\u003e VM1 (10.0.0.5) \n2)Router1 - \u003e Subenetwork1 (default router)\n3)Router2 -\u003e Subenetwork1 (chained router)\n4)Router1 -\u003e ExternalNetwork1 (100.100.100.0/24) -\u003e ExternalBGPVPN1 (100:1)\n5)Router2 -\u003e ExternalNetwork2 (200.200.200.0/24) -\u003e ExternalBGPVPN2 (200:1)\n\nOn DC-GW side, loopback-ips are consider as below\n1)ExternalBGPVPN1 (100:1) having loopback-ip (15.15.15.15)\n2)ExternalBGPVPN2 (200:1) having loopback-ip (25.25.25.25)\n\nThese loopback IPs are got learned on ODL controller via BGP session and the corresponding flows were got installed on the FIB_TABLE (21) as mentioned below sample flows.\n\ncookie\u003d0x8000003, duration\u003d1065.662s, table\u003d21, n_packets\u003d102, n_bytes\u003d7285, priority\u003d42,ip,metadata\u003d0x23a64/0xfffffffe,nw_dst\u003d15.15.15.15 actions\u003dpush_mpls:0x8847,set_field:786433-\u003empls_label,output:2\ncookie\u003d0x8000003, duration\u003d1065.662s, table\u003d21, n_packets\u003d102, n_bytes\u003d7285, priority\u003d42,ip,metadata\u003d0x23a54/0xfffffffe,nw_dst\u003d25.25.25.25 actions\u003dpush_mpls:0x8847,set_field:786433-\u003empls_label,output:2\n\nNote:\nmetadata mapping: \n0x23a64 is ExternalBGPVPN1 (100:1)\n0x23a54 is ExternalBGPVPN2 (200:1)\n\nNow SNAT case, if the VM1(10.0.0.5) is initiate a traffic to 25.25.25.25, the following l3vpn flow match will not happen.\n\nFIB table (21) match: vpn-id\u003drouter1-id,src-ip\u003dsubnet1-ip,dst-ip\u003dext-subnet2-ip set vpn-id\u003drouter2-id \u003d\u003etable 26   \u003e\u003e\u003e\u003e\u003e destination IP is not an CIDR format like UC-1 used for checking the subnet.\n\nHere how can we differentiate the router selection for the learned BGP VPN routes (15.15.15.15, 25.25.25.25)?. (We can’t go with default router. Since default router has connectivity to the different external network than the second chained router).\n\nIn FIB_TABLE (21) based on the external subnet CIDR match criteria will not work for choosing the correct ``router-vpn-id`` to go out the external network traffic. Please let me know your inputs.",
      "revId": "687e8eb9c719ba77c0e94bcf814d6f1d88a852d4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "40a0d2a7_7fa242a4",
        "filename": "docs/specs/router-chaining-for-single-subnet.rst",
        "patchSetId": 12
      },
      "lineNbr": 255,
      "author": {
        "id": 7781
      },
      "writtenOn": "2018-01-09T17:36:45Z",
      "side": 1,
      "message": "Can you please explain little bit more about if the second router is assigned with external-network-2 which router will be acting as default router for the single subnet. Does it choose\u0027d based on the order single subnet is attached to the different routers.",
      "revId": "687e8eb9c719ba77c0e94bcf814d6f1d88a852d4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f36631dc_a2c262f5",
        "filename": "docs/specs/router-chaining-for-single-subnet.rst",
        "patchSetId": 12
      },
      "lineNbr": 269,
      "author": {
        "id": 6545
      },
      "writtenOn": "2018-01-10T10:41:35Z",
      "side": 1,
      "message": "Whenever an router is associated with private-bgpvpn-id, then the vpn-id of this bgp-vpn will be used instead of router-id.\n\nIt would be good to cover this UC with internal router associated with private-bgp-vpn.\n\nRef command:\nneutron bgpvpn-create --name PrivateBgpVpn1 --route-distinguishers 1:1 --route-targets 1:1 --import-targets 1:1 --export-targets 1:1 \n \nneutron bgpvpn-router-assoc-create --router router1 PrivateBgpVpn1",
      "range": {
        "startLine": 269,
        "startChar": 43,
        "endLine": 269,
        "endChar": 60
      },
      "revId": "687e8eb9c719ba77c0e94bcf814d6f1d88a852d4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b20fab82_2233b3fe",
        "filename": "docs/specs/router-chaining-for-single-subnet.rst",
        "patchSetId": 12
      },
      "lineNbr": 272,
      "author": {
        "id": 7781
      },
      "writtenOn": "2018-01-09T17:36:45Z",
      "side": 1,
      "message": "I am not seeing any example flows on table\u003d26, 46, 21 are matching with router1 vpn-id. Since both the routers are associated with different external network. Based on the destination ip, we will be deciding which router has external destination ip presence, we will be choosing that router has defult gw for that external network traffic. Please correct me if i am wrong.",
      "revId": "687e8eb9c719ba77c0e94bcf814d6f1d88a852d4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f1556223_c44332b1",
        "filename": "docs/specs/router-chaining-for-single-subnet.rst",
        "patchSetId": 12
      },
      "lineNbr": 273,
      "author": {
        "id": 7781
      },
      "writtenOn": "2018-01-09T17:39:27Z",
      "side": 1,
      "message": "Please put more clear on which router vpn-id is matching here.",
      "revId": "687e8eb9c719ba77c0e94bcf814d6f1d88a852d4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "49f1fe09_8a7b7aac",
        "filename": "docs/specs/router-chaining-for-single-subnet.rst",
        "patchSetId": 12
      },
      "lineNbr": 277,
      "author": {
        "id": 6545
      },
      "writtenOn": "2018-01-10T10:41:35Z",
      "side": 1,
      "message": "Please cover Conntrack-based SNAT UC table flows(as they are different from Controller-based SNAT)\n\nRef : https://github.com/opendaylight/netvirt/blob/master/docs/specs/conntrack-based-snat.rst",
      "revId": "687e8eb9c719ba77c0e94bcf814d6f1d88a852d4",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    }
  ]
}